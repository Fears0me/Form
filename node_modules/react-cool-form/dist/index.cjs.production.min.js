"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),r=require("@babel/runtime/helpers/extends"),t=require("react"),n=require("dequal/lite");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=u(e),a=u(r),i=function(e){var r=t.useRef(e);return t.useEffect((function(){r.current=e})),r},o=function(e){return e.reduce((function(e,r){return e[r]=!0,e}),{})},s=function(e){return e instanceof FileList},l=function(e){return null!==e&&"object"==typeof e},f=function e(r){if(r instanceof Event)throw new Error("Unable to clone event.");if(!l(r)||s(r))return r;if(r instanceof Date)return new Date(r.getTime());if(Array.isArray(r))return r.map((function(r){return e(r)}));if(l(r))return Object.keys(r).reduce((function(t,n){return t[n]=e(r[n]),t}),{});throw new Error("Unable to clone object.")},v=function(e){return e.filter(Boolean)},d=function(e){return!Array.isArray(e)&&!(e instanceof Date)&&l(e)},b=function e(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];return t.reduce((function(r,t){return Object.keys(t).forEach((function(n){var u=r[n],c=t[n];Array.isArray(u)&&Array.isArray(c)?r[n]=[].concat(u,c):d(u)&&d(c)?r[n]=e(u,c):r[n]=c})),r}),{})},h=function(e){return void 0===e},y=function e(r,t){return d(r)?Object.keys(r).reduce((function(n,u){var c=e(r[u],t[u]||!1);return h(c)?delete n[u]:n[u]=c,n}),{}):t?r:void 0},m=function(e){if("string"!=typeof e)throw new TypeError("Expected a string.");return e.length?v(e.split(/[.[\]]+/)):[]},p=function(e,r,t){if(!d(e)||!r)return t;var n=m(r).reduce((function(e,r){return(e||{})[r]}),e);return h(n)?t:n},k=function(e){return"function"==typeof e},g=function(e){return k(e)&&"AsyncFunction"===e.constructor.name},C=function(e){return"checkbox"===e.type},E=function(e){return d(e)&&!Object.keys(e).length},A=function(e){return/INPUT|TEXTAREA|SELECT/.test(e.tagName)},w=function(e){return"file"===e.type},R=function(e){return"select-multiple"===e.type},j=function(e){return"radio"===e.type},O=function(e,r,t,n){if(void 0===n&&(n=!1),!d(e))throw new TypeError("Expected an object.");var u=m(r),c=n?f(e):e;return u.slice(0,-1).reduce((function(e,r,t){var n=!Number.isNaN(Number(u[t+1]));return d(e[r])&&!n||(e[r]=n?[]:{}),e[r]}),c)[u[u.length-1]||""]=t,c},V=function(e,r,t){if(void 0===t&&(t=!1),!d(e))throw new TypeError("Expected an object.");var n=t?f(e):e,u=n;if(u.hasOwnProperty(r))return delete u[r],n;var c=m(r);if(!c.length)return n;var a=c.pop(),i=c.reduce((function(e,r){return(e||{})[r]}),u);return l(i)&&i.hasOwnProperty(a)&&delete i[a],n},D=function(e,r){var u=t.useReducer((function(e){return e+1}),0)[1],c=t.useRef(e),o=t.useRef({}),s=i(r||function(){}),l=t.useCallback((function(e,r,t){var i=void 0===t?{}:t,l=i.fieldPath,f=i.shouldUpdate,v=void 0===f||f,b=e.split(".")[0];if(b){if("values"!==e&&"values"===b||!n.dequal(p(c.current,e),r)){var h=O(c.current,e,r,!0),y=h.errors,m=h.dirty,k=h.isDirty,g=h.isValid,C=h.submitCount,A="dirty"===b?function(e){return!!function e(r,t){void 0===t&&(t=[]);for(var n=0,u=Object.values(r);n<u.length;n++){var c=u[n];if(!0===c)return t.push(c),t;d(c)&&e(c,t)}return t}(e).length}(m):k,w="errors"===b?E(y):g,R="isSubmitting"===b&&r?C+=1:C;c.current=a.default({},h,{isDirty:A,isValid:w,submitCount:R}),e=l||e,v&&(Object.keys(o.current).some((function(r){return e.startsWith(r)||r.startsWith(e)}))||o.current.isDirty&&A!==k||o.current.isValid&&w!==g)&&(u(),s.current(c.current))}}else n.dequal(c.current,r)||(c.current=r,u(),s.current(c.current))}),[s]),f=t.useCallback((function(e,r){void 0===r&&(r=!1),r?delete o.current[e]:o.current[e]=!0}),[]);return{stateRef:c,setStateRef:l,setUsedStateRef:f}};exports.get=p,exports.set=O,exports.unset=V,exports.useForm=function(e){var r=void 0===e?{}:e,n=r.defaultValues,u=void 0===n?{}:n,l=r.validate,f=r.validateOnChange,m=void 0===f||f,S=r.validateOnBlur,T=void 0===S||S,x=r.builtInValidationMode,L=void 0===x?"message":x,P=r.shouldRemoveField,N=void 0===P||P,q=r.excludeFields,U=void 0===q?[]:q,F=r.onReset,M=r.onSubmit,W=r.onError,B=r.debug,I=t.useRef(!0),_=t.useRef({}),X=t.useRef(),z=t.useRef(),G=t.useRef({}),H=t.useRef({}),J=t.useRef({}),K=t.useRef(o(U)),Q=t.useRef(),Y=i(l),Z=t.useRef({}),$=i(F||function(){}),ee=i(M||function(){}),re=i(W||function(){}),te=t.useRef(u),ne=t.useRef({values:te.current,touched:{},errors:{},isDirty:!1,dirty:{},isValidating:!1,isValid:!0,isSubmitting:!1,isSubmitted:!1,submitCount:0}),ue=D(ne.current,B),ce=ue.stateRef,ae=ue.setStateRef,ie=ue.setUsedStateRef,oe=t.useCallback((function(e){return Array.from(e.querySelectorAll("input,textarea,select")).filter((function(e){var r=e,t=r.type,n=r.name,u=r.dataset.rcfExclude;return!/button|image|submit|reset/.test(t)&&(!(u&&!n)&&(J.current[n]||!(u||K.current[n])))})).reduce((function(e,r){var t=r,n=t.name;return e[n]=a.default({},e[n],{field:r}),(C(t)||j(t))&&(e[n].options=e[n].options?[].concat(e[n].options,[r]):[r]),e}),{})}),[]),se=t.useCallback((function(e,r,t,n){return ae(e,V(t,n,!0),{fieldPath:r})}),[ae]),le=t.useCallback((function(e){var r,t=G.current[e],n=t.field,u=t.options,c=n.value;if("INPUT"===n.tagName){var a,i;if(null!=(a=H.current[e])&&a.valueAsNumber)return c=n.valueAsNumber;if(null!=(i=H.current[e])&&i.valueAsDate)return c=n.valueAsDate}if((function(e){return"number"===e.type}(n)||function(e){return"range"===e.type}(n))&&(c=n.valueAsNumber||""),C(n))if(u){var o=u;c=u.length>1?o.filter((function(e){return e.checked})).map((function(e){return e.value})):o[0].checked}else{var s=p(ce.current.values,n.name);Array.isArray(s)?(s=new Set(s),n.checked?s.add(c):s.delete(c),c=Array.from(s)):c=n.checked}return j(n)&&u&&(c=(null==(r=u.find((function(e){return e.checked})))?void 0:r.value)||""),R(n)&&!u&&(c=Array.from(n.options).filter((function(e){return e.selected})).map((function(e){return e.value}))),w(n)&&(c=n.files),c}),[ce]),fe=t.useCallback((function(e,r){if(G.current[e]&&!J.current[e]){var t=G.current[e],n=t.field,u=t.options;if(C(n)){var c=u;c.length>1?c.forEach((function(e){e.checked=Array.isArray(r)?r.includes(e.value):!!r})):c[0].checked=!!r}else j(n)?u.forEach((function(e){e.checked=e.value===r})):R(n)&&Array.isArray(r)?Array.from(n.options).forEach((function(e){e.selected=!!r.includes(e.value)})):w(n)?(s(r)&&(n.files=r),r||(n.value="")):n.value=null!=r?r:""}}),[]),ve=t.useCallback((function(e,r){h(p(ne.current.values,e))&&(ne.current.values=O(ne.current.values,e,r,!0),ae("values."+e,p(ne.current.values,e),{shouldUpdate:!I.current}))}),[ae]),de=t.useCallback((function(e,r,t){return void 0===r&&(r=!1),void 0===t&&(t=Object.values(G.current)),t.forEach((function(t){var n=d(t)?t.field.name:t;if(!J.current[n]){var u=p(e,n);if(h(u)||fe(n,u),r){var c=p(te.current,n);ve(n,h(c)?le(n):c)}}}))}),[le,ve,fe]),be=t.useCallback((function(e,r){var t=void 0===r?{}:r,n=t.target,u=t.watch,c=void 0===u||u,a=t.errorWithTouched,i=void 0!==a&&a;if(e){var o,s=function(e){return e=n?n+"."+e:e,c&&ie(e),e},l=function(e,r){return c&&i&&e.startsWith("errors")&&r&&!E(r)?(e=e.replace("errors","touched"),ie(e),y(r,p(ce.current,e))):r};if(Array.isArray(e))o=e.map((function(e){return e=s(e),l(e,p(ce.current,e))}));else if(d(e)){var f=e;o=Object.keys(f).reduce((function(r,t){return e=s(f[t]),r[t]=l(e,p(ce.current,e)),r}),{})}else e=s(e),o=l(e,p(ce.current,e));return o}}),[ie,ce]),he=t.useCallback((function(e,r){(r=k(r)?r(p(ce.current.errors,e)):r)?ae("errors."+e,r):se("errors","errors."+e,ce.current.errors,e)}),[se,ae,ce]),ye=t.useCallback((function(e){e?Array.isArray(e)?e.forEach((function(e){return se("errors","errors."+e,ce.current.errors,e)})):se("errors","errors."+e,ce.current.errors,e):ae("errors",{})}),[se,ae,ce]),me=t.useCallback((function(e){if(!1!==L&&G.current[e]){var r=G.current[e].field;if("message"===L)return r.validationMessage;for(var t in r.validity)if("valid"!==t&&r.validity[t])return t}}),[L]),pe=t.useCallback((function(){return!1===L?{}:Object.keys(G.current).reduce((function(e,r){var t=me(r);return e=a.default({},e,t?O({},r,t):{})}),{})}),[L,me]),ke=t.useCallback((async function(e){if(Z.current[e])try{return await Z.current[e](p(ce.current.values,e),ce.current.values)}catch(e){throw e}}),[ce]),ge=t.useCallback((function(){var e=Object.keys(Z.current).map((function(e){return ke(e)}));return Promise.all(e).then((function(e){return Object.keys(Z.current).reduce((function(r,t,n){return r=a.default({},r,e[n]?O({},t,e[n]):{})}),{})}))}),[ke]),Ce=t.useCallback((async function(e){if(!Y.current)return e?void 0:{};try{var r=await Y.current(ce.current.values);return e?p(r,e):d(r)?r:{}}catch(e){throw e}}),[Y,ce]),Ee=t.useCallback((async function(e){var r=g(Y.current)||g(Z.current[e]);r&&ae("isValidating",!0);try{var t=await Ce(e)||await ke(e)||me(e);return he(e,t),r&&ae("isValidating",!1),t}catch(e){return e}}),[Y,me,ke,Ce,he,ae]),Ae=t.useCallback((function(e){return r=function(){return Ee(e)},(window.requestIdleCallback||function(e){var r=Date.now();return setTimeout((function(){return e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-r))}})}),1)})(r,{timeout:2e3});var r}),[Ee]),we=t.useCallback((function(){return ae("isValidating",!0),Promise.all([pe(),ge(),Ce()]).then((function(e){var r=b.apply(void 0,e);return ae("errors",r),ae("isValidating",!1),r}))}),[pe,ge,Ce,ae]),Re=t.useCallback((function(e){return e?Array.isArray(e)?Promise.all(e.map((function(e){return Ee(e)}))).then((function(e){return!v(e).length})):Ee(e).then((function(e){return!e})):we().then((function(e){return E(e)}))}),[Ee,we]),je=t.useCallback((function(e,r,t){void 0===r&&(r=!0),void 0===t&&(t=T),r?ae("touched."+e,!0):se("touched","touched."+e,ce.current.touched,e),t&&Ae(e)}),[se,ae,ce,Ae,T]),Oe=t.useCallback((function(e){return je(e,!0,m?e!==Q.current:void 0)}),[je,m]),Ve=t.useCallback((function(e,r){void 0===r&&(r=!0),r?ae("dirty."+e,!0):se("dirty","dirty."+e,ce.current.dirty,e)}),[se,ae,ce]),De=t.useCallback((function(e){return Ve(e,p(ce.current.values,e)!==p(ne.current.values,e))}),[Ve,ce]),Se=t.useCallback((function(e,r,t){var n=void 0===t?{}:t,u=n.shouldValidate,c=void 0===u?m:u,a=n.shouldTouched,i=void 0===a||a,o=n.shouldDirty,s=void 0===o||o;r=k(r)?r(p(ce.current.values,e)):r,h(r)?se("values","values."+e,ce.current.values,e):ae("values."+e,r),fe(e,r),i&&je(e,!0,!1),s&&De(e),c&&Ae(e)}),[se,De,fe,ae,je,ce,Ae,m]),Te=t.useCallback((function(){return{formState:ce.current,setValue:Se,setTouched:je,setDirty:Ve,setError:he,clearErrors:ye,runValidation:Re,reset:xe,submit:Le}}),[]),xe=t.useCallback((function(e,r,t){null==t||t.preventDefault(),null==t||t.stopPropagation();var n=a.default({},ce.current),u=o(r||[]);Object.keys(n).forEach((function(r){if(!u[r])if("values"===r){var t=(k(e)?e(ce.current.values):e)||ne.current.values;n[r]=t,ne.current.values=t,de(ne.current.values,!!e)}else n[r]=ne.current[r]})),ae("",n),$.current(n.values,Te(),t)}),[Te,$,de,ae,ce]),Le=t.useCallback((async function(e){null==e||e.preventDefault(),null==e||e.stopPropagation();var r=Object.keys(a.default({},G.current,J.current)).reduce((function(e,r){return e=O(e,r,!0,!0)}),ce.current.touched);ae("touched",r),ae("isSubmitting",!0);try{var t=await we();return E(t)?(await ee.current(ce.current.values,Te(),e),ae("isSubmitted",!0),{values:ce.current.values}):(re.current(t,Te(),e),{errors:t})}catch(e){throw e}finally{ae("isSubmitting",!1)}}),[Te,re,ee,ae,ce,we]),Pe=t.useCallback((function(e,r){ae("values."+e,r),De(e),m&&Ae(e)}),[De,ae,Ae,m]),Ne=t.useCallback((function(e,r){var t,n=void 0===r?{}:r,u=n.validate,c=n.value,a=n.defaultValue,i=n.parse,o=n.format,s=n.onChange,l=n.onBlur;if(e){J.current[e]=!0,u&&(Z.current[e]=u);var f=p(te.current,e);return a=h(f)?a:f,h(a)||ve(e,a),c=h(c)?be("values."+e):c,c=null!=(t=o?o(c):c)?t:"",{name:e,value:c,onChange:function(){for(var r,t=arguments.length,n=new Array(t),u=0;u<t;u++)n[u]=arguments[u];if(i)r=i.apply(void 0,n);else{var c=n[0];r=(null==c?void 0:c.nativeEvent)instanceof Event&&A(c.target)?le(e):c}Pe(e,r),s&&s.apply(void 0,n.concat([r])),Q.current=e},onBlur:function(r){Oe(e),l&&l(r),Q.current=void 0}}}}),[le,be,Pe,ve,Oe]),qe=t.useCallback((function(e){if(e){z.current=e;var r=z.current;G.current=oe(r),de(ne.current.values,!0),I.current=!1,_.current.change=function(e){var r=e.target.name;if(r&&G.current[r]&&!J.current[r]){var t,n=null==(t=H.current[r])?void 0:t.parse,u=le(r);Pe(r,n?n(u):u),Q.current=r}},_.current.blur=function(e){var r=e.target;if(A(r)){var t=r.name;G.current[t]&&!J.current[t]&&(Oe(t),Q.current=void 0)}},_.current.submit=function(e){return Le(e)},_.current.reset=function(e){return xe(null,null,e)},r.addEventListener("input",_.current.change),r.addEventListener("focusout",_.current.blur),r.addEventListener("submit",_.current.submit),r.addEventListener("reset",_.current.reset),X.current=new MutationObserver((function(e){if("childList"===e[0].type){var t=oe(r),n=ce.current.values;N&&Object.keys(G.current).forEach((function(e){t[e]||(se("values","values."+e,ce.current.values,e),se("touched","touched."+e,ce.current.touched,e),se("dirty","dirty."+e,ce.current.dirty,e),se("errors","errors."+e,ce.current.errors,e),ie(e,!0),ne.current.values=V(ne.current.values,e,!0),delete H.current[e],delete Z.current[e],delete J.current[e])}));var u=[];Object.keys(t).forEach((function(e){if(!G.current[e]&&!J.current[e]){var r=p(te.current,e);h(r)||(n=O(n,e,r,!0)),u.push(e)}})),G.current=t,u.length&&de(n,!0,u)}})),X.current.observe(r,{childList:!0,subtree:!0})}}),[oe,le,Pe,se,xe,de,Oe,ie,N,ce,Le]),Ue=t.useCallback((function(e){return function(r){if(null!=r&&r.name&&!J.current[r.name]&&!K.current[r.name])if(k(e))Z.current[r.name]=e;else{var t=e.validate,n=c.default(e,["validate"]);t&&(Z.current[r.name]=t),H.current[r.name]=n}}}),[]);return t.useEffect((function(){return function(){var e;if(z.current){var r=_.current;z.current.removeEventListener("input",r.change),z.current.removeEventListener("focusout",r.blur),z.current.removeEventListener("submit",r.submit),z.current.removeEventListener("reset",r.reset),null==(e=X.current)||e.disconnect()}}}),[]),{form:qe,field:Ue,getState:be,setValue:Se,setTouched:je,setDirty:Ve,setError:he,clearErrors:ye,runValidation:Re,reset:xe,submit:Le,controller:Ne}};
//# sourceMappingURL=index.cjs.production.min.js.map
