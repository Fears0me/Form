!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((r="undefined"!=typeof globalThis?globalThis:r||self).ReactCoolForm={},r.React)}(this,(function(r,e){"use strict";function t(){return(t=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r}).apply(this,arguments)}var n=Object.prototype.hasOwnProperty;function u(r,e){var t,c;if(r===e)return!0;if(r&&e&&(t=r.constructor)===e.constructor){if(t===Date)return r.getTime()===e.getTime();if(t===RegExp)return r.toString()===e.toString();if(t===Array){if((c=r.length)===e.length)for(;c--&&u(r[c],e[c]););return-1===c}if(!t||"object"==typeof r){for(t in c=0,r){if(n.call(r,t)&&++c&&!n.call(e,t))return!1;if(!(t in e)||!u(r[t],e[t]))return!1}return Object.keys(e).length===c}}return r!=r&&e!=e}var c=function(r){var t=e.useRef(r);return e.useEffect((function(){t.current=r})),t},i=function(r){return r.reduce((function(r,e){return r[e]=!0,r}),{})},a=function(r){return r instanceof FileList},o=function(r){return null!==r&&"object"==typeof r},s=function r(e){if(e instanceof Event)throw new Error("Unable to clone event.");if(!o(e)||a(e))return e;if(e instanceof Date)return new Date(e.getTime());if(Array.isArray(e))return e.map((function(e){return r(e)}));if(o(e))return Object.keys(e).reduce((function(t,n){return t[n]=r(e[n]),t}),{});throw new Error("Unable to clone object.")},l=function(r){return r.filter(Boolean)},f=function(r){return!Array.isArray(r)&&!(r instanceof Date)&&o(r)},v=function r(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return Object.keys(t).forEach((function(n){var u=e[n],c=t[n];Array.isArray(u)&&Array.isArray(c)?e[n]=[].concat(u,c):f(u)&&f(c)?e[n]=r(u,c):e[n]=c})),e}),{})},d=function(r){return void 0===r},y=function r(e,t){return f(e)?Object.keys(e).reduce((function(n,u){var c=r(e[u],t[u]||!1);return d(c)?delete n[u]:n[u]=c,n}),{}):t?e:void 0},h=function(r){if("string"!=typeof r)throw new TypeError("Expected a string.");return r.length?l(r.split(/[.[\]]+/)):[]},b=function(r,e,t){if(!f(r)||!e)return t;var n=h(e).reduce((function(r,e){return(r||{})[e]}),r);return d(n)?t:n},m=function(r){return"function"==typeof r},p=function(r){return m(r)&&"AsyncFunction"===r.constructor.name},g=function(r){return"checkbox"===r.type},k=function(r){return f(r)&&!Object.keys(r).length},C=function(r){return/INPUT|TEXTAREA|SELECT/.test(r.tagName)},E=function(r){return"file"===r.type},A=function(r){return"select-multiple"===r.type},w=function(r){return"radio"===r.type},O=function(r,e,t,n){if(void 0===n&&(n=!1),!f(r))throw new TypeError("Expected an object.");var u=h(e),c=n?s(r):r;return u.slice(0,-1).reduce((function(r,e,t){var n=!Number.isNaN(Number(u[t+1]));return f(r[e])&&!n||(r[e]=n?[]:{}),r[e]}),c)[u[u.length-1]||""]=t,c},R=function(r,e,t){if(void 0===t&&(t=!1),!f(r))throw new TypeError("Expected an object.");var n=t?s(r):r,u=n;if(u.hasOwnProperty(e))return delete u[e],n;var c=h(e);if(!c.length)return n;var i=c.pop(),a=c.reduce((function(r,e){return(r||{})[e]}),u);return o(a)&&a.hasOwnProperty(i)&&delete a[i],n},j=function(r,n){var i=e.useReducer((function(r){return r+1}),0)[1],a=e.useRef(r),o=e.useRef({}),s=c(n||function(){}),l=e.useCallback((function(r,e,n){var c=void 0===n?{}:n,l=c.fieldPath,v=c.shouldUpdate,d=void 0===v||v,y=r.split(".")[0];if(y){if("values"!==r&&"values"===y||!u(b(a.current,r),e)){var h=O(a.current,r,e,!0),m=h.errors,p=h.dirty,g=h.isDirty,C=h.isValid,E=h.submitCount,A="dirty"===y?function(r){return!!function r(e,t){void 0===t&&(t=[]);for(var n=0,u=Object.values(e);n<u.length;n++){var c=u[n];if(!0===c)return t.push(c),t;f(c)&&r(c,t)}return t}(r).length}(p):g,w="errors"===y?k(m):C,R="isSubmitting"===y&&e?E+=1:E;a.current=t({},h,{isDirty:A,isValid:w,submitCount:R}),r=l||r,d&&(Object.keys(o.current).some((function(e){return r.startsWith(e)||e.startsWith(r)}))||o.current.isDirty&&A!==g||o.current.isValid&&w!==C)&&(i(),s.current(a.current))}}else u(a.current,e)||(a.current=e,i(),s.current(a.current))}),[s]),v=e.useCallback((function(r,e){void 0===e&&(e=!1),e?delete o.current[r]:o.current[r]=!0}),[]);return{stateRef:a,setStateRef:l,setUsedStateRef:v}};r.get=b,r.set=O,r.unset=R,r.useForm=function(r){var n=void 0===r?{}:r,u=n.defaultValues,o=void 0===u?{}:u,s=n.validate,h=n.validateOnChange,T=void 0===h||h,S=n.validateOnBlur,D=void 0===S||S,V=n.builtInValidationMode,P=void 0===V?"message":V,x=n.shouldRemoveField,L=void 0===x||x,N=n.excludeFields,U=void 0===N?[]:N,F=n.onReset,M=n.onSubmit,B=n.onError,I=n.debug,W=e.useRef(!0),q=e.useRef({}),_=e.useRef(),X=e.useRef(),z=e.useRef({}),G=e.useRef({}),H=e.useRef({}),J=e.useRef(i(U)),K=e.useRef(),Q=c(s),Y=e.useRef({}),Z=c(F||function(){}),$=c(M||function(){}),rr=c(B||function(){}),er=e.useRef(o),tr=e.useRef({values:er.current,touched:{},errors:{},isDirty:!1,dirty:{},isValidating:!1,isValid:!0,isSubmitting:!1,isSubmitted:!1,submitCount:0}),nr=j(tr.current,I),ur=nr.stateRef,cr=nr.setStateRef,ir=nr.setUsedStateRef,ar=e.useCallback((function(r){return Array.from(r.querySelectorAll("input,textarea,select")).filter((function(r){var e=r,t=e.type,n=e.name,u=e.dataset.rcfExclude;return!/button|image|submit|reset/.test(t)&&(!(u&&!n)&&(H.current[n]||!(u||J.current[n])))})).reduce((function(r,e){var n=e,u=n.name;return r[u]=t({},r[u],{field:e}),(g(n)||w(n))&&(r[u].options=r[u].options?[].concat(r[u].options,[e]):[e]),r}),{})}),[]),or=e.useCallback((function(r,e,t,n){return cr(r,R(t,n,!0),{fieldPath:e})}),[cr]),sr=e.useCallback((function(r){var e,t=z.current[r],n=t.field,u=t.options,c=n.value;if("INPUT"===n.tagName){var i,a;if(null!=(i=G.current[r])&&i.valueAsNumber)return c=n.valueAsNumber;if(null!=(a=G.current[r])&&a.valueAsDate)return c=n.valueAsDate}if((function(r){return"number"===r.type}(n)||function(r){return"range"===r.type}(n))&&(c=n.valueAsNumber||""),g(n))if(u){var o=u;c=u.length>1?o.filter((function(r){return r.checked})).map((function(r){return r.value})):o[0].checked}else{var s=b(ur.current.values,n.name);Array.isArray(s)?(s=new Set(s),n.checked?s.add(c):s.delete(c),c=Array.from(s)):c=n.checked}return w(n)&&u&&(c=(null==(e=u.find((function(r){return r.checked})))?void 0:e.value)||""),A(n)&&!u&&(c=Array.from(n.options).filter((function(r){return r.selected})).map((function(r){return r.value}))),E(n)&&(c=n.files),c}),[ur]),lr=e.useCallback((function(r,e){if(z.current[r]&&!H.current[r]){var t=z.current[r],n=t.field,u=t.options;if(g(n)){var c=u;c.length>1?c.forEach((function(r){r.checked=Array.isArray(e)?e.includes(r.value):!!e})):c[0].checked=!!e}else w(n)?u.forEach((function(r){r.checked=r.value===e})):A(n)&&Array.isArray(e)?Array.from(n.options).forEach((function(r){r.selected=!!e.includes(r.value)})):E(n)?(a(e)&&(n.files=e),e||(n.value="")):n.value=null!=e?e:""}}),[]),fr=e.useCallback((function(r,e){d(b(tr.current.values,r))&&(tr.current.values=O(tr.current.values,r,e,!0),cr("values."+r,b(tr.current.values,r),{shouldUpdate:!W.current}))}),[cr]),vr=e.useCallback((function(r,e,t){return void 0===e&&(e=!1),void 0===t&&(t=Object.values(z.current)),t.forEach((function(t){var n=f(t)?t.field.name:t;if(!H.current[n]){var u=b(r,n);if(d(u)||lr(n,u),e){var c=b(er.current,n);fr(n,d(c)?sr(n):c)}}}))}),[sr,fr,lr]),dr=e.useCallback((function(r,e){var t=void 0===e?{}:e,n=t.target,u=t.watch,c=void 0===u||u,i=t.errorWithTouched,a=void 0!==i&&i;if(r){var o,s=function(r){return r=n?n+"."+r:r,c&&ir(r),r},l=function(r,e){return c&&a&&r.startsWith("errors")&&e&&!k(e)?(r=r.replace("errors","touched"),ir(r),y(e,b(ur.current,r))):e};if(Array.isArray(r))o=r.map((function(r){return r=s(r),l(r,b(ur.current,r))}));else if(f(r)){var v=r;o=Object.keys(v).reduce((function(e,t){return r=s(v[t]),e[t]=l(r,b(ur.current,r)),e}),{})}else r=s(r),o=l(r,b(ur.current,r));return o}}),[ir,ur]),yr=e.useCallback((function(r,e){(e=m(e)?e(b(ur.current.errors,r)):e)?cr("errors."+r,e):or("errors","errors."+r,ur.current.errors,r)}),[or,cr,ur]),hr=e.useCallback((function(r){r?Array.isArray(r)?r.forEach((function(r){return or("errors","errors."+r,ur.current.errors,r)})):or("errors","errors."+r,ur.current.errors,r):cr("errors",{})}),[or,cr,ur]),br=e.useCallback((function(r){if(!1!==P&&z.current[r]){var e=z.current[r].field;if("message"===P)return e.validationMessage;for(var t in e.validity)if("valid"!==t&&e.validity[t])return t}}),[P]),mr=e.useCallback((function(){return!1===P?{}:Object.keys(z.current).reduce((function(r,e){var n=br(e);return r=t({},r,n?O({},e,n):{})}),{})}),[P,br]),pr=e.useCallback((async function(r){if(Y.current[r])try{return await Y.current[r](b(ur.current.values,r),ur.current.values)}catch(r){throw r}}),[ur]),gr=e.useCallback((function(){var r=Object.keys(Y.current).map((function(r){return pr(r)}));return Promise.all(r).then((function(r){return Object.keys(Y.current).reduce((function(e,n,u){return e=t({},e,r[u]?O({},n,r[u]):{})}),{})}))}),[pr]),kr=e.useCallback((async function(r){if(!Q.current)return r?void 0:{};try{var e=await Q.current(ur.current.values);return r?b(e,r):f(e)?e:{}}catch(r){throw r}}),[Q,ur]),Cr=e.useCallback((async function(r){var e=p(Q.current)||p(Y.current[r]);e&&cr("isValidating",!0);try{var t=await kr(r)||await pr(r)||br(r);return yr(r,t),e&&cr("isValidating",!1),t}catch(r){return r}}),[Q,br,pr,kr,yr,cr]),Er=e.useCallback((function(r){return e=function(){return Cr(r)},(window.requestIdleCallback||function(r){var e=Date.now();return setTimeout((function(){return r({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})}),1)})(e,{timeout:2e3});var e}),[Cr]),Ar=e.useCallback((function(){return cr("isValidating",!0),Promise.all([mr(),gr(),kr()]).then((function(r){var e=v.apply(void 0,r);return cr("errors",e),cr("isValidating",!1),e}))}),[mr,gr,kr,cr]),wr=e.useCallback((function(r){return r?Array.isArray(r)?Promise.all(r.map((function(r){return Cr(r)}))).then((function(r){return!l(r).length})):Cr(r).then((function(r){return!r})):Ar().then((function(r){return k(r)}))}),[Cr,Ar]),Or=e.useCallback((function(r,e,t){void 0===e&&(e=!0),void 0===t&&(t=D),e?cr("touched."+r,!0):or("touched","touched."+r,ur.current.touched,r),t&&Er(r)}),[or,cr,ur,Er,D]),Rr=e.useCallback((function(r){return Or(r,!0,T?r!==K.current:void 0)}),[Or,T]),jr=e.useCallback((function(r,e){void 0===e&&(e=!0),e?cr("dirty."+r,!0):or("dirty","dirty."+r,ur.current.dirty,r)}),[or,cr,ur]),Tr=e.useCallback((function(r){return jr(r,b(ur.current.values,r)!==b(tr.current.values,r))}),[jr,ur]),Sr=e.useCallback((function(r,e,t){var n=void 0===t?{}:t,u=n.shouldValidate,c=void 0===u?T:u,i=n.shouldTouched,a=void 0===i||i,o=n.shouldDirty,s=void 0===o||o;e=m(e)?e(b(ur.current.values,r)):e,d(e)?or("values","values."+r,ur.current.values,r):cr("values."+r,e),lr(r,e),a&&Or(r,!0,!1),s&&Tr(r),c&&Er(r)}),[or,Tr,lr,cr,Or,ur,Er,T]),Dr=e.useCallback((function(){return{formState:ur.current,setValue:Sr,setTouched:Or,setDirty:jr,setError:yr,clearErrors:hr,runValidation:wr,reset:Vr,submit:Pr}}),[]),Vr=e.useCallback((function(r,e,n){null==n||n.preventDefault(),null==n||n.stopPropagation();var u=t({},ur.current),c=i(e||[]);Object.keys(u).forEach((function(e){if(!c[e])if("values"===e){var t=(m(r)?r(ur.current.values):r)||tr.current.values;u[e]=t,tr.current.values=t,vr(tr.current.values,!!r)}else u[e]=tr.current[e]})),cr("",u),Z.current(u.values,Dr(),n)}),[Dr,Z,vr,cr,ur]),Pr=e.useCallback((async function(r){null==r||r.preventDefault(),null==r||r.stopPropagation();var e=Object.keys(t({},z.current,H.current)).reduce((function(r,e){return r=O(r,e,!0,!0)}),ur.current.touched);cr("touched",e),cr("isSubmitting",!0);try{var n=await Ar();return k(n)?(await $.current(ur.current.values,Dr(),r),cr("isSubmitted",!0),{values:ur.current.values}):(rr.current(n,Dr(),r),{errors:n})}catch(r){throw r}finally{cr("isSubmitting",!1)}}),[Dr,rr,$,cr,ur,Ar]),xr=e.useCallback((function(r,e){cr("values."+r,e),Tr(r),T&&Er(r)}),[Tr,cr,Er,T]),Lr=e.useCallback((function(r,e){var t,n=void 0===e?{}:e,u=n.validate,c=n.value,i=n.defaultValue,a=n.parse,o=n.format,s=n.onChange,l=n.onBlur;if(r){H.current[r]=!0,u&&(Y.current[r]=u);var f=b(er.current,r);return i=d(f)?i:f,d(i)||fr(r,i),c=d(c)?dr("values."+r):c,c=null!=(t=o?o(c):c)?t:"",{name:r,value:c,onChange:function(){for(var e,t=arguments.length,n=new Array(t),u=0;u<t;u++)n[u]=arguments[u];if(a)e=a.apply(void 0,n);else{var c=n[0];e=(null==c?void 0:c.nativeEvent)instanceof Event&&C(c.target)?sr(r):c}xr(r,e),s&&s.apply(void 0,n.concat([e])),K.current=r},onBlur:function(e){Rr(r),l&&l(e),K.current=void 0}}}}),[sr,dr,xr,fr,Rr]),Nr=e.useCallback((function(r){if(r){X.current=r;var e=X.current;z.current=ar(e),vr(tr.current.values,!0),W.current=!1,q.current.change=function(r){var e=r.target.name;if(e&&z.current[e]&&!H.current[e]){var t,n=null==(t=G.current[e])?void 0:t.parse,u=sr(e);xr(e,n?n(u):u),K.current=e}},q.current.blur=function(r){var e=r.target;if(C(e)){var t=e.name;z.current[t]&&!H.current[t]&&(Rr(t),K.current=void 0)}},q.current.submit=function(r){return Pr(r)},q.current.reset=function(r){return Vr(null,null,r)},e.addEventListener("input",q.current.change),e.addEventListener("focusout",q.current.blur),e.addEventListener("submit",q.current.submit),e.addEventListener("reset",q.current.reset),_.current=new MutationObserver((function(r){if("childList"===r[0].type){var t=ar(e),n=ur.current.values;L&&Object.keys(z.current).forEach((function(r){t[r]||(or("values","values."+r,ur.current.values,r),or("touched","touched."+r,ur.current.touched,r),or("dirty","dirty."+r,ur.current.dirty,r),or("errors","errors."+r,ur.current.errors,r),ir(r,!0),tr.current.values=R(tr.current.values,r,!0),delete G.current[r],delete Y.current[r],delete H.current[r])}));var u=[];Object.keys(t).forEach((function(r){if(!z.current[r]&&!H.current[r]){var e=b(er.current,r);d(e)||(n=O(n,r,e,!0)),u.push(r)}})),z.current=t,u.length&&vr(n,!0,u)}})),_.current.observe(e,{childList:!0,subtree:!0})}}),[ar,sr,xr,or,Vr,vr,Rr,ir,L,ur,Pr]),Ur=e.useCallback((function(r){return function(e){if(null!=e&&e.name&&!H.current[e.name]&&!J.current[e.name])if(m(r))Y.current[e.name]=r;else{var t=r.validate,n=function(r,e){if(null==r)return{};var t,n,u={},c=Object.keys(r);for(n=0;n<c.length;n++)t=c[n],e.indexOf(t)>=0||(u[t]=r[t]);return u}(r,["validate"]);t&&(Y.current[e.name]=t),G.current[e.name]=n}}}),[]);return e.useEffect((function(){return function(){var r;if(X.current){var e=q.current;X.current.removeEventListener("input",e.change),X.current.removeEventListener("focusout",e.blur),X.current.removeEventListener("submit",e.submit),X.current.removeEventListener("reset",e.reset),null==(r=_.current)||r.disconnect()}}}),[]),{form:Nr,field:Ur,getState:dr,setValue:Sr,setTouched:Or,setDirty:jr,setError:yr,clearErrors:hr,runValidation:wr,reset:Vr,submit:Pr,controller:Lr}},Object.defineProperty(r,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.production.min.js.map
